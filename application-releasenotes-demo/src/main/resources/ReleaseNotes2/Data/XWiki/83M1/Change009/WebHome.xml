<?xml version="1.0" encoding="UTF-8"?>

<!--
 * See the NOTICE file distributed with this work for additional
 * information regarding copyright ownership.
 *
 * This is free software; you can redistribute it and/or modify it
 * under the terms of the GNU Lesser General Public License as
 * published by the Free Software Foundation; either version 2.1 of
 * the License, or (at your option) any later version.
 *
 * This software is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * Lesser General Public License for more details.
 *
 * You should have received a copy of the GNU Lesser General Public
 * License along with this software; if not, write to the Free
 * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
 * 02110-1301 USA, or see the FSF site: http://www.fsf.org.
-->

<xwikidoc version="1.2" reference="ReleaseNotes2.Data.XWiki.8\.3M1.Change009.WebHome" locale="">
  <web>ReleaseNotes2.Data.XWiki.8\.3M1.Change009</web>
  <name>WebHome</name>
  <language/>
  <defaultLanguage/>
  <translation>0</translation>
  <parent>ReleaseNotes2.Data.WebHome</parent>
  <creator>xwiki:XWiki.Admin</creator>
  <creationDate>1474303633000</creationDate>
  <author>xwiki:XWiki.Admin</author>
  <contentAuthor>xwiki:XWiki.Admin</contentAuthor>
  <date>1474625381000</date>
  <contentUpdateDate>1474386602000</contentUpdateDate>
  <version>1.1</version>
  <title>Change009</title>
  <comment/>
  <minorEdit>false</minorEdit>
  <syntaxId>xwiki/2.1</syntaxId>
  <hidden>false</hidden>
  <content/>
  <object>
    <name>ReleaseNotes2.Data.XWiki.8\.3M1.Change009.WebHome</name>
    <number>0</number>
    <className>ReleaseNotes2.Code.ChangesClass</className>
    <guid>8c180c76-b4ab-4476-b750-c15e7676dab2</guid>
    <class>
      <name>ReleaseNotes2.Code.ChangesClass</name>
      <customClass/>
      <customMapping/>
      <defaultViewSheet/>
      <defaultEditSheet/>
      <defaultWeb/>
      <nameField/>
      <validationScript/>
      <audience>
        <cache>0</cache>
        <customDisplay/>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>audience</name>
        <number>7</number>
        <picker>0</picker>
        <prettyName>Target Audience</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>1</size>
        <sort>none</sort>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <values>user=User|administrator=Administrator|developer=Developer</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </audience>
      <category>
        <cache>0</cache>
        <classname/>
        <customDisplay/>
        <disabled>0</disabled>
        <displayType>input</displayType>
        <idField/>
        <multiSelect>0</multiSelect>
        <name>category</name>
        <number>2</number>
        <picker>1</picker>
        <prettyName>Category</prettyName>
        <relationalStorage>1</relationalStorage>
        <separator> </separator>
        <separators/>
        <size>30</size>
        <sort>none</sort>
        <sql/>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <valueField/>
        <classType>com.xpn.xwiki.objects.classes.DBListClass</classType>
      </category>
      <description>
        <customDisplay/>
        <disabled>0</disabled>
        <editor>---</editor>
        <name>description</name>
        <number>5</number>
        <picker>0</picker>
        <prettyName>Additional Description (Optional)</prettyName>
        <rows>20</rows>
        <size>120</size>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </description>
      <importance>
        <cache>0</cache>
        <customDisplay/>
        <disabled>0</disabled>
        <displayType>select</displayType>
        <multiSelect>0</multiSelect>
        <name>importance</name>
        <number>8</number>
        <picker>0</picker>
        <prettyName>Importance</prettyName>
        <relationalStorage>0</relationalStorage>
        <separator> </separator>
        <separators>|, </separators>
        <size>30</size>
        <sort>none</sort>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <values>2=High|1=Medium|0=Low</values>
        <classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
      </importance>
      <product>
        <cache>0</cache>
        <classname/>
        <customDisplay/>
        <disabled>0</disabled>
        <displayType>input</displayType>
        <idField/>
        <multiSelect>0</multiSelect>
        <name>product</name>
        <number>9</number>
        <picker>1</picker>
        <prettyName>Product</prettyName>
        <relationalStorage>1</relationalStorage>
        <separator> </separator>
        <separators/>
        <size>30</size>
        <sort>none</sort>
        <sql/>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <valueField/>
        <classType>com.xpn.xwiki.objects.classes.DBListClass</classType>
      </product>
      <screenshots>
        <customDisplay/>
        <disabled>0</disabled>
        <name>screenshots</name>
        <number>6</number>
        <picker>0</picker>
        <prettyName>Screenshots</prettyName>
        <size>90</size>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </screenshots>
      <summary>
        <customDisplay/>
        <disabled>0</disabled>
        <editor>---</editor>
        <name>summary</name>
        <number>4</number>
        <picker>0</picker>
        <prettyName>Short Description</prettyName>
        <rows>20</rows>
        <size>120</size>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
      </summary>
      <title>
        <customDisplay/>
        <disabled>0</disabled>
        <name>title</name>
        <number>3</number>
        <picker>0</picker>
        <prettyName>Title</prettyName>
        <size>30</size>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <classType>com.xpn.xwiki.objects.classes.StringClass</classType>
      </title>
      <version>
        <cache>0</cache>
        <classname/>
        <customDisplay/>
        <disabled>0</disabled>
        <displayType>input</displayType>
        <idField/>
        <multiSelect>0</multiSelect>
        <name>version</name>
        <number>1</number>
        <picker>1</picker>
        <prettyName>Version</prettyName>
        <relationalStorage>1</relationalStorage>
        <separator> </separator>
        <separators/>
        <size>30</size>
        <sort>none</sort>
        <sql/>
        <unmodifiable>0</unmodifiable>
        <validationMessage/>
        <validationRegExp/>
        <valueField/>
        <classType>com.xpn.xwiki.objects.classes.DBListClass</classType>
      </version>
    </class>
    <property>
      <audience>developer</audience>
    </property>
    <property>
      <category>Core</category>
    </property>
    <property>
      <description>In the past the opposite was already possible (defining a variable in Groovy or in any JSR223 scripting language and accessing it from Velocity), but there were some limitations. For example it was impossible to overwrite in groovy a binding that was already in the ##VelocityContext##. Since the ##VelocityContext## and ##ScriptContext## were not fully in sync, it was leading to many hack having to deal with both (and often forgetting one of the other).

From now on if you want to set some binding for whatever script is going to be executed next you should to it through ##ScriptContext## and completely forget that ##VelocityContext## ever existed in most cases.

New APIs to help with that:

* ##VelocityManager#evaluate(Writer out, String templateName, Reader source)## which execute the passed velocity content with the passed template name and write the result in the passed Writer. This method deal with ##VelocityContext## internally
* ##ScriptContextManager#getCurrentScriptContext()## should be used when you want to SET something in the current script context so that it end up in a script that might be executed later
* ##ScriptContextManager#getScriptContext()## is not new but should be used only if you want to get the ##ScriptContext## exactly as a script would get it (to see if it contains something you want to access), this should be a rare use case.</description>
    </property>
    <property>
      <importance>1</importance>
    </property>
    <property>
      <product>XWiki</product>
    </property>
    <property>
      <screenshots/>
    </property>
    <property>
      <summary>##VelocityContext## and ##ScriptContext## are now fully in sync (and if you find a use case where it's not true create a BUG on  http://jira.xwiki.org) and VelocityContext is now close to internal detail. This allows for example defining a variable in Velocity and accessing it from a Groovy script:

{{code}}
{{velocity}}
## Setting some script binding in Velocity
#set($myvar = "toto")
{{/velocity}}

{{groovy}}
// Lets use the script binding that has been set in previous script
print myvar
{{/groovy}}
{{/code}}
</summary>
    </property>
    <property>
      <title>Velocity and ScriptContext synchronization</title>
    </property>
    <property>
      <version>8.3-milestone-1</version>
    </property>
  </object>
</xwikidoc>
